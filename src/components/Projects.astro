---
import GitHub from "./icons/GitHub.astro";
import NextJS from "./icons/NextJS.astro";
import Tailwind from "./icons/Tailwind.astro";
import Link from "./icons/Link.astro";
import LinkButton from "./LinkButton.astro";
import SQL from "./icons/SQL.astro";
import Figma from "./icons/Figma.astro";
import Tableau from "./icons/Tableau.astro";
import Excel from "./icons/Excel.astro";
import Prototype from "./icons/Pro.astro";

/* ===== Global tag registry (style moved to .kvns-badge) ===== */
const TAGS = {
  NEXT: { name: "Next.js", icon: NextJS, iconSize: "w-4 h-4" },
  TAILWIND: { name: "Tailwind CSS", icon: Tailwind, iconSize: "w-4 h-4" },
  GITHUB: { name: "GitHub", icon: GitHub, iconSize: "w-4 h-4" },
  LINK: { name: "Live", icon: Link, iconSize: "w-4 h-4" },
  SQL: { name: "SQL", icon: SQL, iconSize: "w-4 h-4" },
  FIGMA: { name: "Figma", icon: Figma, iconSize: "w-4 h-4" },
  TABLEAU: { name: "Tableau", icon: Tableau, iconSize: "w-4 h-4" },
  EXCEL: { name: "Excel", icon: Excel, iconSize: "w-3.5 h-3.5" },
  PROTOTYPE: { name: "Prototype", icon: Prototype, iconSize: "w-4 h-4" },
};

/* ===== Global category registry (also uses .kvns-badge) ===== */
const CATEGORIES = {
  WEB_DEV: { name: "Web Development" },
  DATA_ANALYST: { name: "Data Analyst" },
  UIUX: { name: "UI/UX Designer" },
  GRAPHIC: { name: "Graphic Design" },
};

const PROJECTS = [
  {
    title: "Harvesty - Sustainable Farming For A Healthier Future",
    description:
      "An information system related to agriculture. This system, ‘Harvesty’, helps manage agricultural product sales efficiently.",
    link: "https://idlaesy.github.io/harvesty/",
    prototype:
      "https://www.figma.com/design/SiRm4zOGvOHXEVt8pz7dyZ/Harvesty---Capstone-Project-2024?node-id=19-125&t=GfnVlIsMf4TjDT5K-1",
    github: "https://github.com/idlaesy/harvesty.git",
    image: "/harvesty.webp",
    tags: [TAGS.NEXT, TAGS.TAILWIND],
    categories: [CATEGORIES.WEB_DEV],
  },
  {
    title: "SIPAD (Data Analysis Monitoring Information System)",
    description:
      "A disaster data analysis prototype called ‘SIPAD’. The project utilizes Excel for data cleaning and visualization.",
    prototype:
      "https://www.figma.com/design/u5ZzqxZfjYboeGLYgSiIoT/Sistem-Kebencanaan-Kota-Bandar-Lampung?node-id=0-1&t=SSSPvh0B42fkFlIA-1",
    link: "https://www.figma.com/proto/u5ZzqxZfjYboeGLYgSiIoT/Sistem-Kebencanaan-Kota-Bandar-Lampung?page-id=2%3A5&node-id=499-13187&viewport=533%2C465%2C0.1&t=wvvjt4GvfgyAa9Bp-1&scaling=scale-down",
    image: "/SIPAD.webp",
    tags: [TAGS.EXCEL, TAGS.FIGMA, TAGS.PROTOTYPE],
    categories: [CATEGORIES.DATA_ANALYST, CATEGORIES.UIUX],
  },
  {
    title: "REFORA (Reservation Food of ITERA)",
    description:
      "‘REFORA’ is a canteen food reservation prototype designed for ITERA students to streamline food ordering.",
    prototype:
      "https://www.figma.com/design/98IOkbRcQo6lRO0oRG0rnj/Design-Aplikasi-Kantin-ITERA?node-id=0-1&t=Eji0Ln7EmTipN38T-1",
    link: "https://www.figma.com/proto/98IOkbRcQo6lRO0oRG0rnj/Design-Aplikasi-Kantin-ITERA?page-id=0%3A1&node-id=121-4276&p=f&viewport=483%2C518%2C0.04&t=u8h8ymUQVqwwp1aT-1&scaling=scale-down",
    image: "/REFORA.webp",
    tags: [TAGS.FIGMA, TAGS.PROTOTYPE],
    categories: [CATEGORIES.UIUX],
  },
];
---

<div id="kvns-projects" class="relative flex flex-col gap-y-24 md:gap-y-32">
  {
    PROJECTS.map((project, index) => {
      const reverse = index % 2 === 1;
      return (
        <article
          class={`kvns-project group relative flex flex-col-reverse md:flex-row items-center gap-10 md:gap-16 ${
            reverse ? "md:flex-row-reverse" : ""
          } opacity-0 translate-y-6 transition-all duration-700 ease-out`}
        >
          {/* Image */}
          <div class="w-full md:w-1/2 relative">
            <div
              class="relative overflow-hidden rounded-3xl
                   border border-[hsl(var(--brand-h)_50%_50%_/_0.22)]
                   bg-[hsl(var(--brand-h)_60%_40%_/_0.06)]
                   backdrop-blur-xl
                   shadow-[0_6px_22px_hsl(210_30%_10%_/_0.08)]
                   hover:shadow-[0_12px_34px_hsl(var(--brand-h)_60%_20%_/_0.14)]
                   transition-all duration-600 ease-out
                   hover:-translate-y-1 hover:scale-[1.01]"
            >
              <img
                src={project.image}
                alt={project.title}
                class="object-cover w-full h-64 sm:h-72 md:h-[22rem]
                     transition-transform duration-700 ease-out group-hover:scale-[1.015]"
                loading="lazy"
              />
              <div
                class="absolute inset-0 rounded-3xl
                     bg-gradient-to-t from-black/30 via-transparent to-transparent
                     opacity-0 group-hover:opacity-50
                     transition-opacity duration-700"
                aria-hidden="true"
              />
            </div>

            {/* Subtle brand underline */}
            <div
              class="absolute -bottom-3 left-0 right-0 h-[2px]
                   bg-gradient-to-r from-transparent via-[hsl(var(--brand-h)_60%_40%_/_0.35)] to-transparent
                   blur-md opacity-80"
              aria-hidden="true"
            />
          </div>

          {/* Info */}
          <div class="w-full md:w-1/2 space-y-4 relative">
            <div
              class="absolute -top-10 right-10 w-24 h-24
                   bg-[radial-gradient(40%_40%_at_70%_30%,hsl(var(--brand-h)_60%_40%_/_0.22),transparent)]
                   rounded-full blur-3xl opacity-60 pointer-events-none"
              aria-hidden="true"
            />

            <h3
              class="text-3xl sm:text-4xl font-extrabold
                   bg-[linear-gradient(120deg,var(--brand-400),var(--brand-500))]
                   bg-clip-text text-transparent
                   drop-shadow-[0_1px_2px_hsl(var(--brand-h)_40%_20%_/_0.15)]
                   tracking-tight"
            >
              {project.title}
            </h3>

            {/* Categories */}
            <ul class="flex flex-wrap gap-2 mb-3">
              {project.categories.map((cat) => (
                <li>
                  <span class="kvns-badge kvns-badge--cat">{cat.name}</span>
                </li>
              ))}
            </ul>

            {/* Tags */}
            <ul class="flex flex-wrap gap-2">
              {project.tags.map((tag) => (
                <li>
                  <span class="kvns-badge kvns-badge--tag flex items-center gap-1.5">
                    <tag.icon class={`${tag.iconSize} drop-shadow-sm`} />
                    {tag.name}
                  </span>
                </li>
              ))}
            </ul>

            <p class="text-gray-600 dark:text-gray-400 leading-relaxed mt-4 text-sm sm:text-base">
              {project.description}
            </p>

            {/* CTAs */}
            <footer class="flex flex-wrap gap-3 mt-6">
              {project.github && (
                <LinkButton
                  href={project.github}
                  class="kvns-cta kvns-cta--ghost"
                >
                  <GitHub class="w-5 h-5" /> Code
                </LinkButton>
              )}
              {project.link && (
                <LinkButton
                  href={project.link}
                  class="kvns-cta kvns-cta--ghost"
                >
                  <Link class="w-5 h-5" /> Preview
                </LinkButton>
              )}
              {project.prototype && (
                <LinkButton
                  href={project.prototype}
                  class="kvns-cta kvns-cta--solid"
                >
                  <Prototype class="w-5 h-5" /> Prototype
                </LinkButton>
              )}
            </footer>
          </div>
        </article>
      );
    })
  }
</div>

<style is:global>
  /* =======================
   Global Tokens Assumed:
   --brand-h/s/l, --brand-400/500 already defined in your V5 theme
   ======================= */

  /* Reusable badge (TG2: subtle gradient) */
  .kvns-badge {
    --_bg: linear-gradient(
      120deg,
      hsl(
        var(--brand-h) calc(var(--brand-s) - 18%) calc(var(--brand-l) + 14%) /
          0.95
      ),
      hsl(var(--brand-h) var(--brand-s) calc(var(--brand-l) + 8%) / 0.95)
    );
    color: white;
    padding: 0.4rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    background: var(--_bg);
    box-shadow: 0 2px 8px hsl(var(--brand-h) 60% 20% / 0.14);
    transition:
      transform 0.25s var(--ease, cubic-bezier(0.2, 0.6, 0.2, 1)),
      box-shadow 0.25s var(--ease, cubic-bezier(0.2, 0.6, 0.2, 1));
  }
  .kvns-badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px hsl(var(--brand-h) 60% 20% / 0.18);
  }
  .kvns-badge--cat {
    opacity: 0.95;
  }
  .kvns-badge--tag {
    opacity: 1;
  }

  /* CTA variants (cohesive with “Open PDF”) */
  .kvns-cta {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.55rem 0.9rem;
    border-radius: 0.9rem;
    font-weight: 600;
    font-size: 0.95rem;
    transition:
      transform 0.25s var(--ease, cubic-bezier(0.2, 0.6, 0.2, 1)),
      box-shadow 0.25s var(--ease, cubic-bezier(0.2, 0.6, 0.2, 1)),
      background 0.25s,
      color 0.25s;
  }
  .kvns-cta--ghost {
    border: 1px solid hsl(var(--brand-h) 50% 50% / 0.3);
    color: hsl(var(--brand-h) 60% 40%);
    background: transparent;
  }
  .kvns-cta--ghost:hover {
    background: linear-gradient(120deg, var(--brand-400), var(--brand-500));
    color: #fff;
    box-shadow: 0 8px 24px hsl(var(--brand-h) 60% 20% / 0.22);
    transform: translateY(-1px);
  }
  .kvns-cta--solid {
    background: linear-gradient(120deg, var(--brand-400), var(--brand-500));
    color: #fff;
    box-shadow: 0 6px 18px hsl(var(--brand-h) 60% 20% / 0.18);
  }
  .kvns-cta--solid:hover {
    filter: brightness(1.04);
    transform: translateY(-1px);
    box-shadow: 0 10px 26px hsl(var(--brand-h) 60% 20% / 0.22);
  }

  /* Appear animation (subtle) */
  @keyframes kvnsFadeUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .kvns-project.show {
    animation: kvnsFadeUp 0.7s var(--ease, cubic-bezier(0.2, 0.6, 0.2, 1)) both;
  }

  /* Responsive micro-tweaks */
  @media (max-width: 640px) {
    #kvns-projects h3 {
      font-size: 1.75rem;
    }
  }
</style>

<script>
  /* IntersectionObserver — safer scope + reduced motion support */
  if (typeof window !== "undefined") {
    const prefersReduced = window.matchMedia(
      "(prefers-reduced-motion: reduce)"
    ).matches;
    const articles = document.querySelectorAll("#kvns-projects .kvns-project");
    if (prefersReduced) {
      articles.forEach((el) => {
        el.classList.add("show");
        (el as HTMLElement).style.opacity = "1";
        (el as HTMLElement).style.transform = "none";
      });
    } else {
      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("show");
              io.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.18 }
      );
      articles.forEach((el) => io.observe(el));
    }
  }
</script>
