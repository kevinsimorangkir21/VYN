---
import LinkInline from "./LinkInline.astro";

interface Props {
  title: string;
  company: string;
  description: string;
  link?: string;
  date: string;
  status: string;
  index?: number;
  isLast?: boolean;
}

const {
  title,
  company,
  description,
  link,
  date,
  status,
  index = 0,
  isLast = false,
} = Astro.props as Props;

// ðŸŽ¨ Warna status badge modern teal
const statusColors = {
  Freelance: "bg-[#266668]/20 text-[#266668] border border-[#266668]/40",
  Internship: "bg-[#a19665]/20 text-[#a19665] border border-[#a19665]/40",
  Ongoing: "bg-yellow-200/20 text-yellow-700 border border-yellow-500/30",
  Project: "bg-blue-200/20 text-blue-700 border border-blue-500/30",
};

const badgeClass =
  statusColors[status] ||
  "bg-gray-100/30 text-gray-800 dark:bg-gray-800/40 dark:text-gray-200";
---

<div
  class={`timeline-item relative mx-5 sm:mx-8 pb-14 grid opacity-0 translate-y-8 
  transition-all duration-700 ease-out
  before:absolute before:left-[-22px] before:top-0 before:block 
  before:w-[2px] before:bg-[#266668]/60
  md:grid-cols-5 md:gap-12
  ${index % 2 === 0 ? "slide-left" : "slide-right"}
  ${isLast ? "before:h-[2rem]" : "before:h-full"}`}
>
  <!-- âœ¨ Kiri: Info -->
  <div class="relative pb-8 md:col-span-2 group">
    <div class="sticky top-0">
      <!-- Titik Timeline -->
      <span
        class="absolute -left-[26px] top-1 z-10 w-3.5 h-3.5 rounded-full
        bg-[#266668] shadow-[0_0_15px_rgba(38,102,104,0.6)]
        ring-[2px] ring-white/30 dark:ring-[#0b0b0b]/60 pulse-dot"
      ></span>

      <!-- Judul -->
      <h3
        class="text-xl sm:text-2xl font-bold text-[#266668] group-hover:text-[#a19665]
               transition-all duration-500 tracking-wide drop-shadow-sm"
      >
        {title}
      </h3>

      <h4
        class="font-medium text-base sm:text-lg text-gray-700 dark:text-gray-200 italic"
      >
        {company}
      </h4>

      <!-- Status -->
      <span
        class={`inline-block mt-2 px-3 py-0.5 text-xs font-medium rounded-full shadow-sm backdrop-blur ${badgeClass}`}
      >
        {status}
      </span>

      <time
        class="block mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400 font-light"
      >
        {date}
      </time>
    </div>
  </div>

  <!-- âœ¨ Kanan: Deskripsi -->
  <div
    class="relative flex flex-col gap-2 pb-4 text-gray-600 dark:text-gray-300
           md:col-span-3 leading-relaxed text-sm sm:text-base transition-all duration-700"
  >
    <div
      class="relative p-4 rounded-2xl bg-white/10 dark:bg-[#111]/40
             border border-[#266668]/30
             hover:border-[#a19665]/50 hover:shadow-[0_0_35px_rgba(161,150,101,0.25)]
             shadow-[0_0_10px_rgba(38,102,104,0.1)]
             transition-all duration-700 backdrop-blur-md hover:translate-x-1 hover:scale-[1.01]"
    >
      <div class="text-justify">
        {description}
        {link && <LinkInline href={link} />}
      </div>
    </div>
  </div>
</div>

<style is:global>
  /* âœ¨ Timeline line */
  .timeline-item::before {
    content: "";
    position: absolute;
    left: -22px;
    top: 0;
    width: 2px;
    background: #26666880;
  }

  /* ðŸŒŸ Pulse titik timeline */
  @keyframes pulseGlow {
    0%,
    100% {
      box-shadow:
        0 0 8px rgba(38, 102, 104, 0.5),
        0 0 18px rgba(161, 150, 101, 0.3);
      transform: scale(1);
    }
    50% {
      box-shadow:
        0 0 25px rgba(38, 102, 104, 0.9),
        0 0 45px rgba(161, 150, 101, 0.4);
      transform: scale(1.15);
    }
  }
  .pulse-dot {
    animation: pulseGlow 3s ease-in-out infinite;
  }

  /* ðŸŒ€ Slide animations */
  @keyframes fadeSlideLeft {
    from {
      opacity: 0;
      transform: translate(-60px, 20px);
    }
    to {
      opacity: 1;
      transform: translate(0, 0);
    }
  }
  @keyframes fadeSlideRight {
    from {
      opacity: 0;
      transform: translate(60px, 20px);
    }
    to {
      opacity: 1;
      transform: translate(0, 0);
    }
  }
  .timeline-item.show.slide-left {
    animation: fadeSlideLeft 1s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  .timeline-item.show.slide-right {
    animation: fadeSlideRight 1s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
</style>

<script>
  if (typeof window !== "undefined") {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry, i) => {
          if (entry.isIntersecting) {
            entry.target.style.animationDelay = `${i * 0.15}s`;
            entry.target.classList.add("show");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15 }
    );

    document
      .querySelectorAll(".timeline-item")
      .forEach((el) => observer.observe(el));
  }
</script>
