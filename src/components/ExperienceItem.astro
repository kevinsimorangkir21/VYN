---
import LinkInline from "./LinkInline.astro";

type StatusType = "Freelance" | "Internship" | "Ongoing" | "Project";

interface Props {
  title: string;
  company: string;
  description: string;
  link?: string;
  date: string;
  status: StatusType;
  index?: number;
  isLast?: boolean;
}

const {
  title,
  company,
  description,
  link,
  date,
  status,
  index = 0,
  isLast = false,
} = Astro.props as Props;

// ðŸŽ¨ Warna badge berdasarkan status
const statusColors = {
  Freelance: "bg-[#0f7095]/20 text-[#0f7095] border border-[#0f7095]/40",
  Internship: "bg-[#a19665]/20 text-[#a19665] border border-[#a19665]/40",
  Ongoing: "bg-yellow-200/20 text-yellow-700 border border-yellow-500/30",
  Project: "bg-blue-200/20 text-blue-700 border border-blue-500/30",
  Internal: "bg-[#6b9080]/20 text-[#6b9080] border border-[#6b9080]/40",
  External: "bg-[#b85c38]/20 text-[#b85c38] border border-[#b85c38]/40",
};

const badgeClass =
  statusColors[status] ||
  "bg-gray-100/30 text-gray-800 dark:bg-gray-800/40 dark:text-gray-200";
---

<div
  class={`timeline-item relative mx-5 sm:mx-8 pb-14 grid opacity-0 translate-y-8 
  transition-all duration-700 ease-out
  before:absolute before:left-[-14px] before:top-[14px] before:block 
  before:w-[2px] before:bg-[#0f7095]/50 dark:before:bg-[#0f7095]/30
  md:grid-cols-5 md:gap-12
  ${index % 2 === 0 ? "slide-left" : "slide-right"}
  ${isLast ? "before:h-[2rem]" : "before:h-full"}`}
>
  <!-- âœ¨ Kiri -->
  <div class="relative pb-8 md:col-span-2 group">
    <div class="relative">
      <!-- Titik Timeline -->
      <span
        class="absolute -left-[19px] top-[6px] z-10 w-4 h-4 rounded-full
        bg-[#0f7095] border-2 border-white dark:border-[#0b0b0b]
        shadow-[0_0_12px_rgba(15,112,149,0.7)]
        pulse-dot"
      ></span>

      <!-- Judul -->
      <h3
        class="text-xl sm:text-2xl font-bold text-[#0f7095] group-hover:text-[#a19665]
               transition-all duration-500 tracking-wide"
      >
        {title}
      </h3>

      <h4
        class="font-medium text-base sm:text-lg text-gray-700 dark:text-gray-200 italic"
      >
        {company}
      </h4>

      <!-- Status -->
      <span
        class={`inline-block mt-2 px-3 py-0.5 text-xs font-medium rounded-full shadow-sm backdrop-blur ${badgeClass}`}
      >
        {status}
      </span>

      <time
        class="block mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400 font-light"
      >
        {date}
      </time>
    </div>
  </div>

  <!-- âœ¨ Kanan -->
  <div
    class="relative flex flex-col gap-2 pb-4 text-gray-600 dark:text-gray-300
           md:col-span-3 leading-relaxed text-sm sm:text-base transition-all duration-700"
  >
    <div
      class="relative p-4 rounded-2xl bg-white/10 dark:bg-[#111]/40
             border border-[#0f7095]/30
             hover:border-[#a19665]/50 hover:shadow-[0_0_25px_rgba(15,112,149,0.25)]
             shadow-[0_0_10px_rgba(15,112,149,0.1)]
             transition-all duration-700 backdrop-blur-md hover:translate-x-1 hover:scale-[1.01]"
    >
      <div class="text-justify">
        {description}
        {link && <LinkInline href={link} />}
      </div>
    </div>
  </div>
</div>

<style is:global>
  /* ðŸŒŸ Pulse titik timeline */
  @keyframes pulseGlow {
    0%,
    100% {
      box-shadow:
        0 0 8px rgba(15, 112, 149, 0.6),
        0 0 16px rgba(161, 150, 101, 0.3);
      transform: scale(1);
    }
    50% {
      box-shadow:
        0 0 20px rgba(15, 112, 149, 0.9),
        0 0 35px rgba(161, 150, 101, 0.5);
      transform: scale(1.15);
    }
  }
  .pulse-dot {
    animation: pulseGlow 3s ease-in-out infinite;
  }

  /* ðŸŒ€ Slide animations */
  @keyframes fadeSlideLeft {
    from {
      opacity: 0;
      transform: translate(-60px, 20px);
    }
    to {
      opacity: 1;
      transform: translate(0, 0);
    }
  }
  @keyframes fadeSlideRight {
    from {
      opacity: 0;
      transform: translate(60px, 20px);
    }
    to {
      opacity: 1;
      transform: translate(0, 0);
    }
  }
  .timeline-item.show.slide-left {
    animation: fadeSlideLeft 1s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  .timeline-item.show.slide-right {
    animation: fadeSlideRight 1s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }

  /* ðŸ“± Responsif */
  @media (max-width: 640px) {
    .timeline-item::before {
      left: -10px;
    }
    .timeline-item span {
      left: -15px !important;
    }
  }
</style>

<script>
  if (typeof window !== "undefined") {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry, i) => {
          if (entry.isIntersecting) {
            (entry.target as HTMLElement).style.animationDelay = `${i * 0.15}s`;
            entry.target.classList.add("show");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15 }
    );

    document
      .querySelectorAll(".timeline-item")
      .forEach((el) => observer.observe(el));
  }
</script>
