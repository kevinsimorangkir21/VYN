---
const { show = true, once = false } = Astro.props;
---

<div
  id="popup"
  data-once={once ? "true" : "false"}
  class={`fixed inset-0 z-50 flex items-center justify-center 
          bg-black/50 backdrop-blur-sm transition-opacity duration-500
          ${show ? "opacity-100" : "opacity-0 pointer-events-none hidden"}`}
>
  <div
    id="popupContent"
    class="relative bg-white dark:bg-zinc-900 text-black dark:text-white 
           rounded-3xl shadow-2xl max-w-sm w-full mx-4 overflow-hidden 
           transform transition-all duration-300 scale-95 opacity-0 translate-y-4 p-8 text-center"
  >
    <!-- Icon -->
    <div class="flex justify-center mb-4">
      <div class="text-5xl animate-bounce">✌️</div>
    </div>

    <!-- Title -->
    <h2 class="text-xl font-bold mb-2 text-[#C4B073]">
      Domain Has Moved!
    </h2>

    <!-- Description -->
    <p class="text-gray-600 dark:text-gray-300 mb-6">
      Our website has officially moved to a new domain:  
      <br />
      <a 
        href="https://kvn-code.asia" 
        target="_blank" 
        class="font-semibold text-[#C4B073] hover:text-yellow-600 underline transition-colors"
      >
        kvn-code.asia
      </a>
    </p>

    <!-- Button -->
    <div class="flex justify-center">
      <button
        id="okPopup"
        class="px-6 py-2 rounded-xl bg-gradient-to-r from-[#C4B073] to-[#D8C690]
               text-white font-medium shadow hover:scale-[1.03] active:scale-[0.97]
               transition-transform duration-150"
      >
        OK
      </button>
    </div>
  </div>
</div>

<style>
  @keyframes popupShow {
    from {
      opacity: 0;
      transform: scale(0.9) translateY(10px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }
</style>

<script is:inline>
  function initPopup() {
    const popup = document.getElementById("popup");
    const content = document.getElementById("popupContent");
    if (!popup || !content) return;

    const okBtn = document.getElementById("okPopup");
    const once = popup.dataset.once === "true";

    // Prevent popup from showing again if dismissed
    if (once && sessionStorage.getItem("popupDismissed")) {
      popup.classList.add("hidden", "opacity-0", "pointer-events-none");
      return;
    }

    // Show popup with animation
    setTimeout(() => {
      content.style.animation = "popupShow 0.3s ease-out forwards";
    }, 100);

    function closePopup() {
      content.style.opacity = "0";
      content.style.transform = "scale(0.95) translateY(10px)";
      popup.classList.add("opacity-0", "pointer-events-none");
      setTimeout(() => popup.classList.add("hidden"), 300);
      if (once) sessionStorage.setItem("popupDismissed", "true");
    }

    okBtn?.addEventListener("click", closePopup);
    popup?.addEventListener("click", (e) => {
      if (!content.contains(e.target)) closePopup();
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closePopup();
    });
  }

  document.addEventListener("astro:page-load", initPopup);
  document.addEventListener("astro:after-swap", initPopup);
</script>
