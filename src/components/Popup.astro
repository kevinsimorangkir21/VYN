---
const { show = true, once = false } = Astro.props;
---

<div
  id="popup"
  data-once={once ? "true" : "false"}
  class={`fixed inset-0 bg-gradient-to-br from-black/60 to-slate-900/40 backdrop-blur-md flex items-center justify-center z-50 transition-opacity duration-300 ${
    show ? "opacity-100" : "hidden opacity-0 pointer-events-none"
  }`}
>
  <div
    id="popupContent"
    class="bg-white/90 backdrop-blur-sm text-black rounded-2xl shadow-2xl max-w-lg w-full p-6 space-y-4 relative transform transition-all duration-300 scale-95"
  >
    <!-- Close button -->
    <button
      id="closePopup"
      class="absolute top-2 right-2 text-gray-600 hover:text-black text-xl"
      aria-label="Close"
    >
      âœ–
    </button>

    <!-- Content -->
    <h2 class="text-2xl font-bold">âš ï¸ Maintenance Notice</h2>
    <div class="space-y-2">
      <p>
        The website <strong>kvn-tech.xyz</strong> will undergo maintenance from:<br />
        ğŸ“… <strong>Friday, September 5, 2025</strong> at <strong>19:00 WIB</strong><br />
        until<br />
        ğŸ“… <strong>Sunday, September 7, 2025</strong> at <strong>19:00 WIB</strong>.
      </p>
      <p class="text-red-500">We apologize for the inconvenience ğŸ™</p>
    </div>

    <div class="flex justify-end pt-4">
      <button
        id="okPopup"
        class="px-4 py-2 rounded-lg bg-sky-500 hover:bg-sky-600 text-white font-medium shadow-md transition"
      >
        OK
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const popup = document.getElementById("popup");
    const content = document.getElementById("popupContent");
    const closeBtn = document.getElementById("closePopup");
    const okBtn = document.getElementById("okPopup");

    const once = popup?.dataset.once === "true";

    // Hide immediately if once=true and already dismissed this session
    if (once && sessionStorage.getItem("popupDismissed")) {
      popup.classList.add("hidden", "opacity-0", "pointer-events-none");
      return;
    }

    function closePopup() {
      popup.classList.add("opacity-0", "pointer-events-none");
      setTimeout(() => popup.classList.add("hidden"), 300);
      if (once) sessionStorage.setItem("popupDismissed", "true");
    }

    closeBtn?.addEventListener("click", closePopup);
    okBtn?.addEventListener("click", closePopup);

    // Close on outside click
    popup?.addEventListener("click", (e) => {
      if (!content.contains(e.target)) closePopup();
    });

    // Close on Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closePopup();
    });
  });
</script>
